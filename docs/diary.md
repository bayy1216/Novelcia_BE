# 2024-07-18
- ERD설계 : [ERD-CLOUD](https://www.erdcloud.com/d/gDSmQCFvmiYyNmirq)
- 프로젝트 설정
- 엔터티 클래스 생성
- API 구현 목록 : 
  - 회원가입
  - 태그 생성, 조회
  - 유저 조회, 포인트 충전
  - 작품 생성, 조회

# 2024-07-20
- 단위 테스트 코드 작성
- Soft delete 로직 UseCase로 분리

# 2024-07-21
- 스프링 시큐리티 설정
  - 레디스를 통한 세션 관리
  - 레디스 유틸 함수 작성
- API 구현 목록 :
  - 회원가입(변경) 
  - 로그인
  - 로그아웃
  - 내 정보 조회

# 2024-07-22
- azure Auto Deploy 설정
- Redis, MySQL 프로덕션 환경 설정
- Spring-Config-Server 설정
- API 구현 목록 :
  - 에피소드 상세 조회(미완)

# 2024-07-23
- 도커컴포즈 - 로컬 개발환경 설정
- API 구현:
  - 에피소드 목록 조회(완료)
- JPA version 적용 -> 벌크 연산시, 다른 트랜잭션에서 JPA의 변경감지를 통한 update가 발생하면 벌크연산의 lost update가 발생할 수 있다.

# 2024-07-29 월
- `CPU <> 캐시`처럼 top-n의 인기 novel의 최신 에피소드를 조회할때, 캐시를 사용하는 방법은 어떨까
  - 인기 novel을 확인하는 방법은 API를 통해 프론트엔드에 위임하거나, 인기 novel 버킷을 만든다.
  - 에피소드의 단건 조회를 반환하는 로직: 최근 1개의 에피소드 조회시, 다른 에피소드들도 함께 조회하여 캐시에 저장하는 방법을 고려한다.
  - 다른 에피소드는 어떻게 같이 조회할까?
  - 인기 novel의 경우 
    - TTL 15분으로 캐시 hit를 높여보자
    - 게시글 조회시 커버링 인덱스로 최신 게시글 조회, 주변 +5, -5개의 게시글을 조회하여 캐시에 저장한다.
    - 캐시에 저장된 데이터는 15분 동안 유지되며, 기본적인 정책은 캐시를 갱신하지 않는다.
    - 캐시가 만료되는 순간, 데이터베이스의 데이터 부하가 발생한다.
      - 캐시를 갱신하는 방법은?
      1. 캐시 hit 성공시, 확률적으로 캐시를 갱신한다.(최신 에피소드일수록 가중치를 높게한다)
      2. 캐시 hit 실패시, DB에서 조회시 select for update skip locked를 사용하여 DB의 동시요청 부하를 최적화 한다.(where에는 in절로 id를 넣어서 조회한다.)
         
  - 일반적인 에피소드
    - write가 이루어 지는 시점에 TTL 1시간으로 캐시에 저장한다.
    (캐시를 갱신하지 않기 때문에 관리해야하는 데이터는 유한하다.)
  - key : `novel:episode:24`

# 2024-07-30 화
- episode 읽기시 -> 유저별 unique episode 읽기로그를 INSERT IGNORE로 처리하는건 어떨까
  - `INSERT IGNORE`는 중복된 데이터가 있을 경우, 에러를 무시하고 다음 쿼리를 실행한다.
- UPSERT를 INSERT ... ON DUPLICATE KEY UPDATE로 처리하는건 어떨까
  - `INSERT ... ON DUPLICATE KEY UPDATE`는 중복된 데이터가 있을 경우, UPDATE 쿼리를 실행한다.
  - 활용방안 : 읽자별 읽기 통계, Upsert 로직, 

# 2024-08-02 금
- redis-insight를 통한 redis 모니터링(redis 공식문서에서 확인)
- redis 세션은 계속 세션 갱신을 한다.
  - HttpSessionIdResolver를 통해 로직 커스텀이 가능
  - 세션쿠기가 아닌 X-Auth-Token을 사용하여 세션 요청을 다르게 할 수 있다.
- 개발환경에서 CommandLineRunner를 통해 초기 데이터를 삽입 로직 작성
- 스프링 @Transactional AOP를 코틀린 DSL로 변경하는 작업을 수행

# 2024-08-03 토
- API 구현:
  - 에피소드 관련 수정, 삭제, 좋아요, 좋아요취소

# 2024-08-05 월
- 에피소드 상세 보기시 조회수 증가 테스트 코드 작성
- API 구현:
  - 선호작 관련 API 스펙 정의
  - 소설 분류 API 구현

# 2024-08-08 목
- API 구현:
  - 선호작 조회 페이징 API 구현 (querydsl을 통한 프로젝션)
  - 에피소드 조회 API 스펙변경(에피소드id -> 소설id, 에피소드번호)

# 2024-08-09 금
- API 구현:
  - 에피소드 상세 조회 API 구현
- **TODO**:
  - novel 비정규화한거 비일관성 제거해야함

# 2024-08-10 토
- 에피소드 스코어링 로직 보기 편하게 변경
- 스웨거 서버주소 profile에 따라 변경
- 유저 point 충전 API 멱등키 적용